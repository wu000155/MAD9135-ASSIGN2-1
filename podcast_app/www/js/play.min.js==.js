var my_media;var dur;var isComplete;var mediaTimer=null;var play={showPodcastPage:function(){$('#frontPage').attr('class','hide');$('#informationPage').attr('class','show');console.log($(this).text());for(var i=0;i<podcastArray.length;i++){if(JSON.parse(podcastArray[i]).title==$(this).text()){var infoVar='<div class="info">';infoVar+='<h2>'+$(this).text()+'</h2>';infoVar+='<p class="pubDate">Posted:'+JSON.parse(podcastArray[i]).date+'</p>'infoVar+='<div class="podcastImage"><img src="'+JSON.parse(podcastArray[i]).img+'" alt="podcast image"/></div>'infoVar+='<p class="duration"> Duration:'+JSON.parse(podcastArray[i]).duration+'</p>'infoVar+='</div>'}}if($('.info,#slider')){$('.info,#slider').remove();}$(infoVar).insertBefore($('.controlDiv'));$('<div id="slider"></div>').insertBefore($('#play'));$("#slider ").slider({});var url=cordova.file.externalRootDirectory+"\/"+$('.info h2').text()+".mp3";my_media=new Media(url,play.podcastSuccess,play.podcastFail);play.showProgress();if(app.detectTouchSupport()){$('#pause,#play,#skipBack').bind('touchend',app.handleTouchEnd);$('#pause').bind('tap',play.pausePodcast);$('#play').bind('tap',play.playPodcast);$('#skipBack').bind('tap',play.skipPodcast);}else{$('#pause').bind('click',play.pausePodcast);$('#play').bind('click',play.playPodcast);$('#skipBack').bind('click',play.skipPodcast);}},playPodcast:function(){my_media.getCurrentPosition(function(position){console.log(dur-1)console.log(parseInt(position));if(position<=0){my_media.seekTo(30000);setTimeout(function(){my_media.play();isComplete=false;console.log(isComplete);dur=parseInt(my_media.getDuration());console.log(dur);},10);}else{my_media.play();}},function(e){console.log("Error getting pos="+e);});},pausePodcast:function(){my_media.getCurrentPosition(function(position){if(position>0){my_media.pause();}},function(e){console.log("Error getting pos="+e);});},skipPodcast:function(){my_media.getCurrentPosition(function(position){if(position>10){my_media.seekTo(position*1000-10000);setTimeout(function(){my_media.play();},10);}else if(position<10){my_media.seekTo(0);setTimeout(function(){my_media.play();},10);}},function(e){console.log("Error getting pos="+e);});},showProgress:function(){mediaTimer=setInterval(function(){my_media.getCurrentPosition(function(position){var intPosition=parseInt(position);if(position>=0){console.log((intPosition)+" sec");$("#slider").slider({value:position,max:dur,slide:play.refreshSwatch,change:play.refreshSwatch});}if(intPosition==dur-1){console.log(intPosition);isComplete=true;console.log(isComplete);my_media.stop();}},function(e){console.log("Error getting pos="+e);});},1000);},refreshSwatch:function(){var currentPosition=$("#slider").slider("value");my_media.seekTo(currentPosition*1000);},goBack:function(){$('#frontPage').attr('class','show');$('#informationPage').attr('class','hide');console.log(isComplete);clearInterval(mediaTimer);mediaTimer=null;my_media.release();app.checkdevice();if(isComplete){setTimeout(function(){isComplete=false;console.log(isComplete)},100)}},podcastSuccess:function(){console.log('podcastSuccess');},podcastFail:function(err){console.log("recordAudio():Audio Error: "+err.code);},}